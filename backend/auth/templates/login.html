{% extends "base.html" %}

{% block title %}Login{% endblock %}

{% block content %}
<div class="auth-header">
    <h1 class="auth-title">Login</h1>
</div>

<form class="auth-form" data-form="login">
    <div class="form-group">
        <label for="email" class="form-label">Email Address</label>
        <input 
            type="email" 
            id="email"             
            name="email" 
            class="form-input" 
            placeholder="Enter your email"
            required
        >
    </div>

    <div class="form-group">
        <label for="password" class="form-label">Password</label>
        <input 
            type="password" 
            id="password" 
            name="password" 
            class="form-input" 
            placeholder="Enter your password"
            required
        >
    </div>

    <div class="checkbox-group">
        <input type="checkbox" id="remember" name="remember" class="checkbox">
        <label for="remember" class="checkbox-label">Remember me</label>
    </div>

    <button type="submit" class="btn btn-primary">
        Sign In
    </button>
</form>

<div class="oauth-section">
    <div class="divider">
        <span>or continue with</span>
    </div>
    
    <a href="/auth/google" class="btn btn-google">
        <svg width="18" height="18" viewBox="0 0 18 18" class="google-icon">
            <path fill="#4285f4" d="m18 9.25c0-.69-.06-1.36-.17-2h-8.83v3.78h5.05c-.22 1.17-.88 2.16-1.86 2.83v2.33h3.01c1.76-1.62 2.8-4.01 2.8-6.94z"/>
            <path fill="#34a853" d="m9 18c2.43 0 4.47-.8 5.96-2.18l-3.01-2.33c-.8.54-1.84.86-2.95.86-2.27 0-4.19-1.53-4.88-3.59h-3.11v2.41c1.5 2.98 4.58 5.83 8.99 5.83z"/>
            <path fill="#fbbc04" d="m4.12 10.76c-.17-.54-.27-1.11-.27-1.76s.1-1.22.27-1.76v-2.41h-3.11c-.57 1.08-.89 2.3-.89 3.59s.32 2.51.89 3.59l3.11-2.25z"/>
            <path fill="#ea4335" d="m9 3.58c1.28 0 2.43.44 3.33 1.3l2.5-2.5c-1.51-1.41-3.48-2.27-5.83-2.27-4.41 0-7.49 2.85-8.99 5.83l3.11 2.41c.69-2.06 2.61-3.59 4.88-3.59z"/>
        </svg>
        Sign in with Google
    </a>
</div>

<div class="auth-footer">
    <p>
        <a href="/auth/reset-password" class="auth-link">Forgot your password?</a>
    </p>
    
    <p>
        Don't have an account? 
        <a href="/auth/signup" class="auth-link">Sign up</a>
    </p>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-focus email field
document.addEventListener('DOMContentLoaded', () => {
    // Check for password reset tokens in URL hash
    const hash = window.location.hash;
    if (hash.includes('access_token=') && hash.includes('type=recovery')) {
        // Extract tokens from hash
        const params = new URLSearchParams(hash.substring(1));
        const accessToken = params.get('access_token');
        const refreshToken = params.get('refresh_token');
        const tokenType = params.get('token_type');
        
        if (accessToken) {
            // Redirect to reset-confirm with tokens as query parameters
            const redirectUrl = `/auth/reset-confirm?access_token=${accessToken}&refresh_token=${refreshToken}&token_type=${tokenType}&type=recovery`;
            window.location.replace(redirectUrl);
            return;
        }
    }
    
    document.getElementById('email').focus();
});

</script>
{% endblock %}